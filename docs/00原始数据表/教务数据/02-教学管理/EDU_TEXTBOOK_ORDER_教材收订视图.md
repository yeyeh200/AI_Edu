# EDU_TEXTBOOK_ORDER 教材收订视图

## 基本信息

- **表名**：`EDU_TEXTBOOK_ORDER`（原表名：`V_BRW_LessonBookplan`）
- **中文名称**：教材收订视图
- **用途**：存储教材收订信息，包括学生和教师的教材订购数量，用于教材采购和发放管理
- **字段数量**：15个
- **数据类别**：教务系统 - 教学管理模块

## 字段定义

| 字段名 | 原字段名 | 数据类型 | 长度 | 是否为空 | 主键 | 默认值 | 备注 |
|--------|----------|----------|------|----------|------|--------|------|
| xn | 学年 | CHAR | - | NO | YES | - | 如，2009表示2009-2010学年 |
| xq_id | 学期 | CHAR | - | NO | YES | - | 0第一学期，1第二学期，2第三学期 |
| user_kcdm | 课程/环节代码 | CHAR | - | NO | YES | - | - |
| user_kcdmMC | 课程/环节名称 | CHAR | - | YES | YES | - | - |
| JCDM | 教材代码 | CHAR | - | NO | YES | - | - |
| JCMC | 教材名称 | CHAR | - | YES | NO | - | - |
| ISBN | ISBN号 | CHAR | - | YES | NO | - | - |
| ZZ | 作者 | CHAR | - | YES | NO | - | - |
| BB | 版别 | CHAR | - | YES | NO | - | - |
| BK | 版况 | CHAR | - | YES | NO | - | - |
| CBNY | 出版年月 | CHAR | - | YES | NO | - | 2016-01表示2016年1月 |
| Price | 定价 | DECIMAL | - | YES | NO | - | - |
| XSS | 学生订书数 | NUMBER | - | YES | NO | - | - |
| JSS | 教师订书数 | NUMBER | - | YES | NO | - | - |
| ZSL | 总收订数 | NUMBER | - | YES | NO | - | - |

## 字段详细说明

### 主键字段
- **xn**：学年，主键组成部分
- **xq_id**：学期，主键组成部分
- **user_kcdm**：课程/环节代码，主键组成部分
- **user_kcdmMC**：课程/环节名称，主键组成部分
- **JCDM**：教材代码，主键组成部分

### 课程信息字段
- **user_kcdm**：课程/环节代码，关联课程或实践环节
- **user_kcdmMC**：课程/环节名称，对应的课程或环节名称

### 教材基本信息
- **JCDM**：教材代码，唯一标识教材
- **JCMC**：教材名称，教材的完整名称
- **ISBN**：ISBN号，国际标准书号
- **ZZ**：作者，教材作者或编者

### 版本信息字段
- **BB**：版别，如"第1版"、"第2版"等
- **BK**：版况，如"修订版"、"重印版"等
- **CBNY**：出版年月，格式为YYYY-MM

### 价格和数量字段
- **Price**：定价，教材的单价
- **XSS**：学生订书数，学生订购的教材数量
- **JSS**：教师订书数，教师订购的教材数量
- **ZSL**：总收订数，学生订书数 + 教师订书数

## 学期信息说明

### 学年格式
- **格式说明**：如2009表示2009-2010学年
- **命名规范**：使用起始年份作为学年标识
- **时间范围**：通常从当年9月至次年7月

### 学期定义
| 学期代码 | 学期名称 | 时间范围 | 说明 |
|----------|----------|----------|------|
| 0 | 第一学期 | 9月-次年1月 | 秋季学期 |
| 1 | 第二学期 | 2月-7月 | 春季学期 |
| 2 | 第三学期 | 7月-8月 | 夏季学期（短学期） |

## 版本信息说明

### 版别（BB）分类
- **第1版**：首次出版版本
- **第2版**：第二次修订版本
- **第3版**：第三次修订版本
- **修订版**：内容重大修订
- **重印版**：内容未变重新印刷

### 版况（BK）分类
- **全新版**：全新编写的内容
- **修订版**：在原版基础上修订
- **重印版**：原版重印无内容变化
- **增订版**：在原版基础上增加内容
- **精装版**：精装装帧版本
- **平装版**：平装装帧版本

## 出版时间说明

### 出版年月格式
- **格式标准**：YYYY-MM
- **示例**：2016-01表示2016年1月
- **含义**：教材的正式出版时间

### 出版时间用途
1. **版本管理**：区分不同时间版本
2. **内容新鲜度**：判断内容是否过时
3. **采购参考**：作为采购和库存管理的参考
4. **版权管理**：版权保护期限的参考

## 订购数量说明

### 学生订书数（XSS）
- **计算基础**：基于选课学生数量
- **订购原则**：一人一册，自愿订购
- **调整因素**：
  - 已有教材的学生不订购
  - 考虑退课学生的教材回收
  - 预留一定比例的备用教材

### 教师订书数（JSS）
- **计算基础**：基于任课教师和助教数量
- **订购原则**：任课教师每人一册
- **包含范围**：
  - 主讲教师
  - 辅导教师
  - 助教人员
  - 实验指导教师

### 总收订数（ZSL）
```
总收订数 = 学生订书数 + 教师订书数
```

## 价格信息说明

### 定价（Price）
- **货币单位**：人民币（元）
- **定价标准**：出版社官方定价
- **实际价格**：可能享受批量采购折扣

### 价格构成因素
1. **内容质量**：教材内容的价值
2. **装帧质量**：印刷和装帧成本
3. **作者知名度**：知名作者教材价格较高
4. **出版社级别**：知名出版社价格相对较高
5. **市场需求**：热门教材价格相对较高

## 数据约束

1. **主键约束**：`xn, xq_id, user_kcdm, user_kcdmMC, JCDM` 组合必须唯一
2. **非空约束**：主键字段必须非空
3. **数值约束**：所有数量字段应为非负数
4. **价格约束**：定价字段应为正数
5. **格式约束**：出版年月应符合YYYY-MM格式

## 索引建议

- **复合主键索引**：`xn, xq_id, user_kcdm, JCDM` - 主键自动创建唯一索引
- **学年索引**：`xn` - 用于按学年查询
- **学期索引**：`xq_id` - 用于按学期筛选
- **课程索引**：`user_kcdm` - 用于按课程查询
- **教材索引**：`JCDM` - 用于按教材代码查询
- **ISBN索引**：`ISBN` - 用于按ISBN查询
- **数量索引**：`ZSL` - 用于按订购数量排序

## 数据关联关系

### 主要外键关联
- **课程信息表**：通过 `user_kcdm` 关联课程信息
- **教材信息表**：通过 `JCDM` 关联教材详细信息
- **学生选课表**：通过课程和学期关联选课信息
- **教师信息表**：关联订购教材的教师信息

### 业务关联
- **教材采购表**：根据订购数量进行采购
- **教材发放表**：记录教材发放情况
- **教材库存表**：管理教材库存信息
- **教材财务表**：管理教材费用结算

## 使用示例

### SQL查询示例

```sql
-- 查询某学年学期的教材收订情况
SELECT xn, xq_id, user_kcdmMC, JCMC, XSS, JSS, ZSL, Price
FROM EDU_TEXTBOOK_ORDER
WHERE xn = '2024' AND xq_id = '0'
ORDER BY user_kcdmMC, JCMC;

-- 查询某课程的教材订购详情
SELECT user_kcdmMC, JCMC, ISBN, ZZ, BB, CBNY, Price, ZSL
FROM EDU_TEXTBOOK_ORDER
WHERE user_kcdm = 'CS001' AND xn = '2024'
ORDER BY JCMC;

-- 统计学期教材订购总量
SELECT
    xn,
    xq_id,
    COUNT(*) as book_types,
    SUM(ZSL) as total_books,
    SUM(ZSL * Price) as total_amount
FROM EDU_TEXTBOOK_ORDER
WHERE xn = '2024'
GROUP BY xn, xq_id
ORDER BY xq_id;

-- 查询订购数量大的教材
SELECT user_kcdmMC, JCMC, XSS, JSS, ZSL, Price, (ZSL * Price) as total_cost
FROM EDU_TEXTBOOK_ORDER
WHERE xn = '2024' AND xq_id = '1'
ORDER BY ZSL DESC;

-- 按出版社统计教材订购情况
SELECT CBNY, COUNT(*) as book_count, SUM(ZSL) as total_quantity
FROM EDU_TEXTBOOK_ORDER
WHERE xn = '2024' AND CBNY IS NOT NULL
GROUP BY CBNY
ORDER BY total_quantity DESC;
```

### 数据插入示例

```sql
INSERT INTO EDU_TEXTBOOK_ORDER (
    xn, xq_id, user_kcdm, user_kcdmMC, JCDM, JCMC,
    ISBN, ZZ, BB, CBNY, Price, XSS, JSS, ZSL
) VALUES (
    '2024', '0', 'CS001', '数据结构', 'TB001',
    '数据结构（C语言版）', '978-7-115-12345-6',
    '严蔚敏', '第2版', '2023-06', 59.00, 120, 3, 123
);
```

## 业务逻辑说明

### 教材收订流程
1. **选课统计**：根据学生选课情况确定教材需求
2. **教师统计**：统计任课教师的教材需求
3. **数量核算**：计算学生和教师的订购数量
4. **汇总上报**：汇总后上报给教材管理部门
5. **采购执行**：根据订购数量进行采购

### 数量确定原则
1. **学生为主**：以学生订购数量为主体
2. **教师保障**：确保教师教学用书需求
3. **适当预留**：预留一定比例的备用教材
4. **经济合理**：避免过量订购造成浪费

### 价格管理
1. **统一标准**：按照出版社定价执行
2. **批量优惠**：争取批量采购折扣
3. **费用公示**：向学生公示教材价格
4. **费用结算**：及时进行费用结算

## 数据维护建议

### 定期维护
1. **数量更新**：及时更新订购数量
2. **价格调整**：根据实际情况调整价格
3. **版本更新**：更新教材版本信息
4. **数据核对**：定期核对数据准确性

### 异常处理
1. **数量异常**：检查订购数量的合理性
2. **价格错误**：纠正错误的价格信息
3. **重复记录**：检查并处理重复订购记录
4. **缺失信息**：补充缺失的教材信息

---

**数据来源**：教务管理系统
**维护单位**：教务处、教材科、各院系
**更新频率**：每学期选课后更新，采购期间可调整